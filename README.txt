==============================================================================
        _____ ____    _        _ _                                    
       |_   _| __ )  | |_ __ _| | |_   _ ___  ___ _ ____   _____ _ __ 
         | | |  _ \  | __/ _` | | | | | / __|/ _ \ '__\ \ / / _ \ '__|
         | | | |_) | | || (_| | | | |_| \__ \  __/ |   \ V /  __/ |   
         |_| |____/___\__\__,_|_|_|\__, |___/\___|_|    \_/ \___|_|   
                 |_____|           |___/                              

==============================================================================
Contact Information
==============================================================================

Organization:     Center for Exascale Simulation of Advanced Reactors (CESAR)
                  Argonne National Laboratory

Development Lead: John Tramm <jtramm@mcs.anl.gov>

==============================================================================
What is TB_tallyserver?
==============================================================================

The goal of the TB tallyserver project is to simulate the Hoogenboom-Martin
reactor with separate tally bins for 10 concentric radial regions and
100 axial cuts for each fuel rod.

TB_tallyserver is an input deck creator for OpenMC, capabel of creating the
input files necessary to define the Hoogenboom-Martin TB model.

When run, the following files are created in the current working
directory. Note that the files are fairly large (~338MB total).

->    geometry.xml
->    tallies.xml

The geometry.xml file defines 636,240 infinite cylinder cells representing
all of the 10 radial regions of each fuel cell.

The tallies.xml file defines a mesh covering the entire reactor zone,
with 100 regions along the z-axis, as well as specifying each of the
636,240 cells as separate tallies. This results in a grand total of
63,624,000 tally spaces.

Considering approximately 33 fuel nuclides, each with 6 reaction types, and
the size of a tally object being 32 bytes, the total tally data can be
calculated as:

	Tally Data = 63,624,000 tallies x 32 bytes/tally x 33 nucs x 6 XS's
	           = 375.4 GB
	           = 0.37  TB

==============================================================================
Quick Start Guide
==============================================================================

Download----------------------------------------------------------------------

	Download of the TB_tallyserver source files are available from our
	github repository (https://github.com/jtramm/TB_tallyerver).

	The repository can be downloaded with the following command:
	
	>$ git clone git://github.com/jtramm/TB_tallyerver.git	

	To begin use of the code, you will have to navigate to
	the src directory:

	>$ cd TB_tallyserver

Compilation-------------------------------------------------------------------

	To compile TB_tallyserver with default settings, use the following
	command:

	>$ make

Running TB_tallyserver--------------------------------------------------------

	To run TB_tallyserver with default settings, use the following command:

	>$ ./tb

	This program is also capabale of generating smaller models, representing
	a smaller portion of the total number of fuel assemblies in the reactor.
	This feature may be useful for testing purposes. Pass in as a command
	line argument the desired number of fuel assemblies to print. i.e.,:

	>$ ./tb 1

	Note that the program will enforce the number of assemblies to be
	between 1 and 241. I.e., 1 <= n_assemblies <= 241

==============================================================================
Updating OpenMC
==============================================================================

You will need to replace the following files with the updated versions:

	src/templates/geometry_t.f90
	src/templates/tallies_t.f90

Note that you will also have to adjust these files based on the number
of assemblies your geometry/tallies files specify. These numbers are
gathered in various locations.

For instance, when running the full 241 assemblies (generated by ./tb or
./tb 241), you will get the following printout:

	User@hostname:~/TB_tallyerver$ ./tb
	Printed 241 Fuel Assemblies
	Printed 636240 Cells
	printed 636240 tallies.

Then, running the count.sh script, you will get the following printout:

	User@hostname:~/TB_tallyerver$ ./count.sh
	cells =
	  636268
	surfaces =
	  636257

With the above two sources of information, we can determine the values
for the following three variables to be:

NCELLS    = 636268
NSURFACES = 636257
NTALLIES  = 636240

You will then need to alter the geometry_t.f90 and tallies_t.f90 values
accordingly.

For geometry_t.f90, you will use the cells and surfaces variables we
determined above. They can be #defined as follows:

#define NCELLS    636268
#define NSURFACES 636257

For tallies_t.f90, you will use the NTALLIES variable we determined above.
It can be #defined as follows:

#define NTALLIES 636240

Once your files have been updated to reflect the desired values, follow
the below procedure:

1) From the src directory, build OpenMC normally:
	>$ make distclean
	>$ make
2) Copy the above 2 files to their destinations in src/templates,
   overwriting the files that are there.
3) From the src directory, run make again:
    >$ make
4) Run OpenMC normally

==============================================================================
Theoretical Basis
==============================================================================

This basis for this reactor model, including specifications for the
geometry, material selection, and nuclide distribution, is specified in
the Hoogenboom-Martin reactor model, as described in the paper below:

J.E. Hoogenboom, W.R. Martin, B. Petrovic, “The Monte Carlo performance
benchmark test aims, specifications and first results,” International
Conference on Mathematics and Computational Methods Applied to Nuclear
Science and Engineering, Rio de Janeiro, Brazil (2011).
